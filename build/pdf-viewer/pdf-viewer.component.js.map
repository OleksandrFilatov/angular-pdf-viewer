{"version":3,"sources":["../../src/pdf-viewer/pdf-viewer.component.ts"],"names":[],"mappings":"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","file":"pdf-viewer.component.js","sourceRoot":"","sourcesContent":["/**\n * Created by vadimdez on 21/06/16.\n */\nimport {\n  Component, Input, Output, ElementRef, EventEmitter, OnChanges, SimpleChanges\n} from '@angular/core';\nimport 'pdfjs-dist/build/pdf';\nPDFJS.verbosity = (<any>PDFJS).VERBOSITY_LEVELS.errors;\n\n\n\nexport class PdfViewerComponent implements OnChanges {\n  private _showAll: boolean = false;\n  private _renderText: boolean = true;\n  private _originalSize: boolean = true;\n  private _pdf: PDFDocumentProxy;\n  private _page: number = 1;\n  private _zoom: number = 1;\n  private _rotation: number = 0;\n  private resizeTimeout: NodeJS.Timer;\n\n   afterLoadComplete = new EventEmitter<PDFDocumentProxy>();\n   onError = new EventEmitter<any>();\n   onProgress = new EventEmitter<PDFProgressData>();\n\n  constructor(private element: ElementRef) {\n    PDFJS.workerSrc = 'https://mozilla.github.io/pdf.js/build/pdf.worker.js';\n  }\n\n  \n  src: string | Uint8Array | PDFSource;\n\n  \n  set page(_page) {\n    _page = parseInt(_page, 10);\n\n    if (this._pdf && !this.isValidPageNumber(_page)) {\n      _page = 1;\n    }\n\n    this._page = _page;\n    this.pageChange.emit(_page);\n  }\n\n   pageChange: EventEmitter<number> = new EventEmitter<number>(true);\n\n  \n  set renderText(renderText: boolean) {\n    this._renderText = renderText;\n  }\n\n  \n  set originalSize(originalSize: boolean) {\n    this._originalSize = originalSize;\n  }\n\n  \n  set showAll(value: boolean) {\n    this._showAll = value;\n  }\n\n  \n  set zoom(value: number) {\n    if (value <= 0) {\n      return;\n    }\n\n    this._zoom = value;\n  }\n\n  get zoom() {\n    return this._zoom;\n  }\n\n  \n  set rotation(value: number) {\n    if (!(typeof value === 'number' && value % 90 === 0)) {\n      console.warn('Invalid pages rotation angle.');\n      return;\n    }\n\n    this._rotation = value;\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if ('src' in changes) {\n      this.loadPDF();\n    } else if (this._pdf) {\n      this.update();\n    }\n  }\n\n  public onPageResize() {\n    if (this.resizeTimeout) {\n      clearTimeout(this.resizeTimeout);\n    }\n\n    this.resizeTimeout = setTimeout(() => {\n      this.render();\n    }, 100);\n  }\n\n  private loadPDF() {\n    if (!this.src) {\n      return;\n    }\n\n    let loadingTask: any = PDFJS.getDocument(this.src);\n\n    loadingTask.onProgress = (progressData: PDFProgressData) => {\n      this.onProgress.emit(progressData);\n    };\n\n    (<PDFPromise<PDFDocumentProxy>>loadingTask.promise)\n      .then(pdf => {\n        this._pdf = pdf;\n\n        this.afterLoadComplete.emit(pdf);\n\n        this.update();\n      }, (error: any) => {\n        this.onError.emit(error);\n      });\n  }\n\n  private update() {\n    this.page = this._page;\n\n    this.render();\n  }\n\n  private render() {\n    if (!this._showAll) {\n      this.renderPage(this._page);\n    } else {\n      this.renderMultiplePages();\n    }\n  }\n\n  private renderMultiplePages() {\n    let container = this.element.nativeElement.querySelector('div');\n\n    this.removeAllChildNodes(container);\n\n    // render pages synchronously\n    const render = (page: number) => {\n      this.renderPage(page).then(() => {\n        if (page < this._pdf.numPages) {\n          render(page + 1);\n        }\n      });\n    };\n\n    render(1);\n  }\n\n  private isValidPageNumber(page: number): boolean {\n    return this._pdf.numPages >= page && page >= 1;\n  }\n\n  private renderPage(pageNumber: number): PDFPromise<void> {\n    return this._pdf.getPage(pageNumber).then( (page: PDFPageProxy) => {\n      let viewport = page.getViewport(this._zoom, this._rotation);\n      let container = this.element.nativeElement.querySelector('div');\n\n      if (!this._originalSize) {\n        viewport = page.getViewport(this.element.nativeElement.offsetWidth / viewport.width, this._rotation);\n      }\n\n      if (!this._showAll) {\n        this.removeAllChildNodes(container);\n      }\n\n      return (<any>page).getOperatorList().then( (opList) => {\n        let svgGfx = new (<any>PDFJS).SVGGraphics((<any>page).commonObjs, (<any>page).objs);\n\n        return svgGfx.getSVG(opList, viewport).then( (svg) => {\n          let $div = document.createElement('div');\n\n          $div.classList.add('page');\n          $div.setAttribute('data-page-number', `${ page.pageNumber }`);\n\n          $div.appendChild(svg);\n\n          this.convertAttributeToInlineStyle($div, 'font-family');\n          this.convertAttributeToInlineStyle($div, 'font-size');\n\n          container.appendChild($div);\n        });\n      });\n    });\n  }\n\n  private removeAllChildNodes(element: HTMLElement) {\n    while (element.firstChild) {\n      element.removeChild(element.firstChild);\n    }\n  }\n\n  private convertAttributeToInlineStyle(parent: HTMLElement, attribute: string) {\n    const matchElements = parent.querySelectorAll(`[${ attribute }]`);\n    for (let i = 0, l = matchElements.length; i < l; i++) {\n      const element = matchElements[i];\n      const oldStyle = element.getAttribute('style') || '';\n      element.setAttribute('style', `${ oldStyle } ${ attribute }: ${ element.getAttribute(attribute) };`);\n    }\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  selector: 'pdf-viewer',\n  template: `\n      <div class=\"ng2-pdf-viewer-container\"\n           [ngClass]=\"{'ng2-pdf-viewer--zoom': zoom < 1}\"\n           (window:resize)=\"onPageResize()\"\n      ></div>\n  `,\n  styles: [`\n.ng2-pdf-viewer--zoom {\n  overflow-x: scroll;\n}\n\n:host >>> .ng2-pdf-viewer-container .page {\n  background-color: #fff;\n}\n  `]\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'afterLoadComplete': [{ type: Output, args: ['after-load-complete', ] },],\n'onError': [{ type: Output, args: ['error', ] },],\n'onProgress': [{ type: Output, args: ['on-progress', ] },],\n'src': [{ type: Input },],\n'page': [{ type: Input, args: ['page', ] },],\n'pageChange': [{ type: Output },],\n'renderText': [{ type: Input, args: ['render-text', ] },],\n'originalSize': [{ type: Input, args: ['original-size', ] },],\n'showAll': [{ type: Input, args: ['show-all', ] },],\n'zoom': [{ type: Input, args: ['zoom', ] },],\n'rotation': [{ type: Input, args: ['rotation', ] },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}