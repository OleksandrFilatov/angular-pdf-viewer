{"version":3,"file":"pdf-viewer.component.js","sourceRoot":"","sources":["../../src/pdf-viewer/pdf-viewer.component.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by vadimdez on 21/06/16.\n */\nimport {\n  Component, Input, Output, ElementRef, EventEmitter, OnChanges, SimpleChanges, OnInit\n} from '@angular/core';\nimport 'pdfjs-dist/build/pdf.combined';\n\n@Component({\n  selector: 'pdf-viewer',\n  template: `<div class=\"ng2-pdf-viewer-container\" (window:resize)=\"onPageResize($event)\"><div id=\"viewer\" class=\"pdfViewer\"></div></div>`\n})\n\nexport class PdfViewerComponent implements OnChanges, OnInit {\n  private static CSS_UNITS: number = 96.0 / 72.0;\n\n  private _renderText: boolean = true;\n  private _stickToPage: boolean = false;\n  private _originalSize: boolean = true;\n  private _pdf: PDFDocumentProxy;\n  private _page: number = 1;\n  private _zoom: number = 1;\n  private _rotation: number = 0;\n\n  private _externalLinkTarget: string = 'blank';\n  private _pdfViewer: any;\n  private _pdfLinkService: any;\n  private lastLoaded: string | Uint8Array | PDFSource;\n  private resizeTimeout: any;\n\n  @Output('after-load-complete') afterLoadComplete = new EventEmitter<PDFDocumentProxy>();\n\n  constructor(private element: ElementRef) {\n    PDFJS.disableWorker = true;\n  }\n\n  ngOnInit() {\n    require('pdfjs-dist/web/pdf_viewer');\n    this.setupViewer();\n  }\n\n  onPageResize() {\n    if (this.resizeTimeout) {\n      clearTimeout(this.resizeTimeout);\n    }\n\n    this.resizeTimeout = setTimeout(() => {\n      this.updateSize();\n    }, 100);\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if ('src' in changes) {\n      this.loadPDF();\n    } else if (this._pdf) {\n      if ('renderText' in changes) {\n        this.setupViewer();\n      }\n      this.update();\n    }\n  }\n\n  @Input()\n  src: string | Uint8Array | PDFSource;\n\n  @Input('page')\n  set page(_page) {\n    _page = parseInt(_page, 10);\n\n    if (this._pdf && !this.isValidPageNumber(_page)) {\n      _page = 1;\n    }\n\n    this._page = _page;\n    this.pageChange.emit(_page);\n  }\n\n  @Output() pageChange: EventEmitter<number> = new EventEmitter<number>(true);\n\n  @Input('render-text')\n  set renderText(renderText: boolean) {\n    this._renderText = renderText;\n  }\n\n  @Input('original-size')\n  set originalSize(originalSize: boolean) {\n    this._originalSize = originalSize;\n  }\n\n  @Input('stick-to-page')\n  set stickToPage(value: boolean) {\n    this._stickToPage = value;\n  }\n\n  @Input('zoom')\n  set zoom(value: number) {\n    if (value <= 0) {\n      return;\n    }\n\n    this._zoom = value;\n  }\n\n  @Input('rotation')\n  set rotation(value: number) {\n    if (!(typeof value === 'number' && value % 90 === 0)) {\n      console.warn('Invalid pages rotation angle.');\n      return;\n    }\n\n    this._rotation = value;\n  }\n\n  @Input('external-link-target')\n  set externalLinkTarget(value: string) {\n    this._externalLinkTarget = value;\n  }\n\n  public setupViewer() {\n    (<any>PDFJS).disableTextLayer = !this._renderText;\n\n    this.setExternalLinkTarget(this._externalLinkTarget);\n\n    this._pdfLinkService = new (<any>PDFJS).PDFLinkService();\n    let pdfOptions: any = {\n      container: this.element.nativeElement.querySelector('div'),\n      removePageBorders: true,\n      linkService: this._pdfLinkService\n    };\n\n    this._pdfViewer = new PDFJS.PDFViewer(pdfOptions);\n    this._pdfLinkService.setViewer(this._pdfViewer);\n  }\n\n  public render() {\n    if (!this.isValidPageNumber(this._page)) {\n      this._page = 1;\n    }\n\n    if (this._rotation !== 0 || this._pdfViewer.pagesRotation !== this._rotation) {\n      setTimeout(() => {\n        this._pdfViewer.pagesRotation = this._rotation;\n      });\n    }\n\n    if (this._stickToPage) {\n      setTimeout(() => {\n        this._pdfViewer.currentPageNumber = this._page;\n      });\n    }\n\n    this.updateSize();\n  }\n\n  public updateSize() {\n    if (!this._originalSize) {\n      this._pdf.getPage(this._pdfViewer._currentPageNumber).then((page: PDFPageProxy) => {\n        const scale = this._zoom * (this.element.nativeElement.offsetWidth / page.getViewport(1).width) / PdfViewerComponent.CSS_UNITS;\n        this._pdfViewer._setScale(scale, !this._stickToPage);\n      });\n    } else {\n      this._pdfViewer._setScale(this._zoom, true);\n    }\n  }\n\n  public isValidPageNumber(page: number) {\n    return this._pdf.numPages >= page && page >= 1;\n  }\n\n  private setExternalLinkTarget(type: string) {\n    switch (type) {\n      case 'blank':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.BLANK;\n        break;\n      case 'none':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.NONE;\n        break;\n      case 'self':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.SELF;\n        break;\n      case 'parent':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.PARENT;\n        break;\n      case 'top':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.TOP;\n        break;\n    }\n  }\n\n  private loadPDF() {\n    if (!this.src) {\n      return;\n    }\n\n    if (this.lastLoaded === this.src) {\n      this.update();\n      return;\n    }\n\n    const src = this.src;\n    PDFJS.getDocument(src).then((pdf: PDFDocumentProxy) => {\n      this._pdf = pdf;\n      this.lastLoaded = src;\n\n      this.afterLoadComplete.emit(pdf);\n\n      this.update();\n    });\n  }\n\n  private update() {\n    if (this._pdfViewer) {\n      this._pdfViewer.setDocument(this._pdf);\n    }\n    if (this._pdfLinkService) {\n      this._pdfLinkService.setDocument(this._pdf, null);\n    }\n\n    this.page = this._page;\n\n    this.render();\n  }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}