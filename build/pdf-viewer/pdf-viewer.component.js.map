{"version":3,"file":"pdf-viewer.component.js","sourceRoot":"","sources":["../../src/pdf-viewer/pdf-viewer.component.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by vadimdez on 21/06/16.\n */\nimport {\n  Component, Input, Output, ElementRef, EventEmitter, OnChanges, SimpleChanges, OnInit\n} from '@angular/core';\nimport 'pdfjs-dist/build/pdf.combined';\nimport 'pdfjs-dist/web/pdf_viewer';\n\n\n\nexport class PdfViewerComponent implements OnChanges, OnInit {\n  private static CSS_UNITS: number = 96.0 / 72.0;\n  private _showAll: boolean = true; // TODO : _showAll is not working\n\n  private _renderText: boolean = true;\n  private _stickToPage: boolean = false;\n  private _originalSize: boolean = true;\n  private _pdf: PDFDocumentProxy;\n  private _page: number = 1;\n  private _zoom: number = 1;\n  private _rotation: number = 0;\n\n  private _externalLinkTarget: string = 'blank';\n  private _pdfViewer: any;\n  private _pdfLinkService: any;\n  private lastLoaded: string | Uint8Array | PDFSource;\n\n   afterLoadComplete = new EventEmitter<PDFDocumentProxy>();\n\n  constructor(private element: ElementRef) {\n    PDFJS.workerSrc = 'https://mozilla.github.io/pdf.js/build/pdf.worker.js';\n    //PDFJS.disableWorker = true;\n  }\n\n  ngOnInit() {\n    this.setupViewer();\n  }\n\n  \n  src: string | Uint8Array | PDFSource;\n\n  \n  set page(_page) {\n    _page = parseInt(_page, 10);\n\n    if (this._pdf && !this.isValidPageNumber(_page)) {\n      _page = 1;\n    }\n\n    if (this._page !== _page) {\n      this._page = _page;\n      this.pageChange.emit(_page);\n    }\n  }\n\n   pageChange: EventEmitter<number> = new EventEmitter<number>(true);\n\n  \n  set renderText(renderText: boolean) {\n    this._renderText = renderText;\n  }\n\n  \n  set originalSize(originalSize: boolean) {\n    this._originalSize = originalSize;\n  }\n\n  \n  set showAll(value: boolean) {\n    this._showAll = value;\n  }\n\n  \n  set stickToPage(value: boolean) {\n    this._stickToPage = value;\n  }\n\n  \n  set zoom(value: number) {\n    if (value <= 0) {\n      return;\n    }\n\n    this._zoom = value;\n  }\n\n  \n  set rotation(value: number) {\n    if (!(typeof value === 'number' && value % 90 === 0)) {\n      console.warn('Invalid pages rotation angle.');\n      return;\n    }\n\n    this._rotation = value;\n  }\n\n  \n  set externalLinkTarget(value: string) {\n    this._externalLinkTarget = value;\n  }\n\n  public setupViewer() {\n    (<any>PDFJS).disableTextLayer = !this._renderText;\n\n    this.setExternalLinkTarget(this._externalLinkTarget);\n\n    this._pdfLinkService = new (<any>PDFJS).PDFLinkService();\n    let pdfOptions: any = {\n      container: this.element.nativeElement.querySelector('div'),\n      removePageBorders: true,\n      linkService: this._pdfLinkService\n    };\n\n    this._pdfViewer = new PDFJS.PDFViewer(pdfOptions);\n    this._pdfLinkService.setViewer(this._pdfViewer);\n  }\n\n  private setExternalLinkTarget(type: string) {\n    switch (type) {\n      case 'blank':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.BLANK;\n        break;\n      case 'none':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.NONE;\n        break;\n      case 'self':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.SELF;\n        break;\n      case 'parent':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.PARENT;\n        break;\n      case 'top':\n        (<any>PDFJS).externalLinkTarget = (<any>PDFJS).LinkTarget.TOP;\n        break;\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if ('src' in changes) {\n      this.loadPDF();\n    } else if (this._pdf) {\n      if ('renderText' in changes) {\n        this.setupViewer();\n      }\n      this.update();\n    }\n  }\n\n  private loadPDF() {\n    if (!this.src) {\n      return;\n    }\n\n    if (this.lastLoaded === this.src) {\n      this.update();\n      return;\n    }\n\n    const src = this.src;\n    PDFJS.getDocument(src).then((pdf: PDFDocumentProxy) => {\n      this._pdf = pdf;\n      this.lastLoaded = src;\n\n      this.afterLoadComplete.emit(pdf);\n\n      this.update();\n    });\n  }\n\n  private update() {\n    if (this._pdfViewer) {\n      this._pdfViewer.setDocument(this._pdf);\n    }\n    if (this._pdfLinkService) {\n      this._pdfLinkService.setDocument(this._pdf, null);\n    }\n\n    this.page = this._page;\n\n    this.render();\n  }\n\n  public render() {\n    if (!this.isValidPageNumber(this._page)) {\n      this._page = 1;\n    }\n\n    if (this._rotation !== 0 || this._pdfViewer.pagesRotation !== this._rotation) {\n      setTimeout(() => {\n        this._pdfViewer.pagesRotation = this._rotation;\n      });\n    }\n\n    if (this._stickToPage) {\n      setTimeout(() => {\n        this._pdfViewer.currentPageNumber = this._page;\n      });\n    }\n\n    this.updateSize();\n  }\n\n  public updateSize() {\n    if (!this._originalSize) {\n      this._pdf.getPage(this._pdfViewer._currentPageNumber).then((page: PDFPageProxy) => {\n        const scale = this._zoom * (this.element.nativeElement.offsetWidth / page.getViewport(1).width) / PdfViewerComponent.CSS_UNITS;\n        this._pdfViewer._setScale(scale, !this._stickToPage);\n      });\n    } else {\n      this._pdfViewer._setScale(this._zoom, !this._stickToPage);\n    }\n  }\n\n  public isValidPageNumber(page: number) {\n    return this._pdf.numPages >= page && page >= 1;\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  selector: 'pdf-viewer',\n  template: `<div class=\"ng2-pdf-viewer-container\"><div id=\"viewer\" class=\"pdfViewer\"></div></div>`\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: ({type: any, decorators?: DecoratorInvocation[]}|null)[] = [\n{type: ElementRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'afterLoadComplete': [{ type: Output, args: ['after-load-complete', ] },],\n'src': [{ type: Input },],\n'page': [{ type: Input, args: ['page', ] },],\n'pageChange': [{ type: Output },],\n'renderText': [{ type: Input, args: ['render-text', ] },],\n'originalSize': [{ type: Input, args: ['original-size', ] },],\n'showAll': [{ type: Input, args: ['show-all', ] },],\n'stickToPage': [{ type: Input, args: ['stick-to-page', ] },],\n'zoom': [{ type: Input, args: ['zoom', ] },],\n'rotation': [{ type: Input, args: ['rotation', ] },],\n'externalLinkTarget': [{ type: Input, args: ['external-link-target', ] },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}